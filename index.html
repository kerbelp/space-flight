<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Flight - Space Adventure Game</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Start Screen -->
    <div id="startScreen" class="screen">
        <h1>SPACE FLIGHT</h1>
        <div class="mode-selection">
            <h2>Select Game Mode</h2>
            <div class="buttons">
                <button id="singlePlayerBtn" class="btn">1 Player</button>
                <button id="twoPlayerBtn" class="btn">2 Players</button>
            </div>
        </div>
    </div>

    <!-- Player Name Input Screen -->
    <div id="nameInputScreen" class="screen hidden">
        <h1>ENTER NAMES</h1>
        <div class="name-input-container">
            <div id="player1Input" class="name-input">
                <label for="player1Name">Player 1 Name:</label>
                <input type="text" id="player1Name" maxlength="10" placeholder="Enter name" value="Alex">
                <div class="color-picker">
                    <span>Ship Color:</span>
                    <input type="color" id="player1Color" value="#4CAF50">
                </div>
            </div>
            <div id="player2Input" class="name-input">
                <label for="player2Name">Player 2 Name:</label>
                <input type="text" id="player2Name" maxlength="10" placeholder="Enter name" value="Maya">
                <div class="color-picker">
                    <span>Ship Color:</span>
                    <input type="color" id="player2Color" value="#2196F3">
                </div>
            </div>
            <button id="startGameBtn" class="btn">Start Game</button>
        </div>
    </div>

    <!-- Game Container (initially hidden) -->
    <div id="gameContainer" class="hidden">
        <div class="hud">
            <div class="player1-hud">
                <h2 id="p1-name" style="color: #4CAF50">Player 1</h2>
                <div class="lives">Lives: <span id="p1-lives">3</span></div>
                <div class="score">Score: <span id="score">0</span></div>
            </div>
            <div class="player2-hud">
                <h2 id="p2-name" style="color: #2196F3">Player 2</h2>
                <div class="lives">Lives: <span id="p2-lives">3</span></div>
            </div>
        </div>
        <canvas id="gameCanvas"></canvas>
        <div id="gameOver" class="game-over">
            <h1>Game Over</h1>
            <button id="restartButton" class="btn">Play Again</button>
            <button id="backToMenuBtn" class="btn secondary">Main Menu</button>
        </div>
        <div id="pauseOverlay" class="pause-overlay">
            <h1>Paused</h1>
            <p>Press P to continue</p>
            <button id="menuBtn" class="btn secondary">Main Menu</button>
        </div>
    </div>
    
    <!-- Game script with proper loading and error handling -->
    <script>
        // Error handling for script loading
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.message, 'at', event.filename, 'line', event.lineno);
        });

        // Function to initialize the game after all scripts are loaded
        function initializeGame() {
            console.log('=== GAME INITIALIZATION STARTED ===');
            
            // Verify game functions are available
            const requiredFunctions = ['init', 'setupUI', 'startGame'];
            const missingFunctions = requiredFunctions.filter(fn => typeof window[fn] !== 'function');
            
            if (missingFunctions.length > 0) {
                console.error('❌ Missing required functions:', missingFunctions.join(', '));
                return;
            }
            
            console.log('✅ All required functions are available');
            
            try {
                console.log('Calling init()...');
                init();
                console.log('✅ Game initialized successfully');
            } catch (error) {
                console.error('❌ Error initializing game:', error);
                alert('Failed to initialize the game. Please check the console for errors.');
            }
        }

        // Load game.js dynamically to ensure proper loading order
        function loadGameScript() {
            console.log('Loading game script...');
            const script = document.createElement('script');
            script.src = 'game.js';
            script.onload = function() {
                console.log('✅ game.js loaded successfully');
                // Small delay to ensure all functions are available
                setTimeout(initializeGame, 50);
            };
            script.onerror = function() {
                console.error('❌ Failed to load game.js');
                alert('Failed to load the game script. Please refresh the page to try again.');
            };
            document.body.appendChild(script);
        }

        // Start loading the game when the DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadGameScript);
        } else {
            loadGameScript();
        }
    </script>
</body>
</html>
